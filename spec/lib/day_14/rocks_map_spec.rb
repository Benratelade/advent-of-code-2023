# frozen_string_literal: true

require "day_14/rocks_map"
require "pry"

RSpec.describe RocksMap do
  describe "#initialize" do
    it "creates a matrix based on the string" do
      rocks_map = RocksMap.new(
        <<~ROCKS_MAP,
          O....#....
          O.OO#....#
          .....##...
          OO.#O....O
          .O.....O#.
          O.#..O.#.#
          ..O..#O..O
          .......O..
          #....###..
          #OO..#....
      ROCKS_MAP
      )

      expect(rocks_map.geography).to eq(
        [
          ["O", ".", ".", ".", ".", "#", ".", ".", ".", "."],
          ["O", ".", "O", "O", "#", ".", ".", ".", ".", "#"],
          [".", ".", ".", ".", ".", "#", "#", ".", ".", "."],
          ["O", "O", ".", "#", "O", ".", ".", ".", ".", "O"],
          [".", "O", ".", ".", ".", ".", ".", "O", "#", "."],
          ["O", ".", "#", ".", ".", "O", ".", "#", ".", "#"],
          [".", ".", "O", ".", ".", "#", "O", ".", ".", "O"],
          [".", ".", ".", ".", ".", ".", ".", "O", ".", "."],
          ["#", ".", ".", ".", ".", "#", "#", "#", ".", "."],
          ["#", "O", "O", ".", ".", "#", ".", ".", ".", "."],
        ],
      )
    end
  end

  describe ".tilt" do
    it "moves all rocks that can move in ONCE in the provided direction" do
      rocks_map = RocksMap.new(
        <<~ROCKS_MAP,
          O....#....
          O.OO#....#
          .....##...
          OO.#O....O
          .O.....O#.
          O.#..O.#.#
          ..O..#O..O
          .......O..
          #....###..
          #OO..#....
      ROCKS_MAP
      )

      expect(rocks_map.tilt(:north).geography).to eq(
        [
          ["O", ".", "O", "O", ".", "#", ".", ".", ".", "."],
          ["O", ".", ".", ".", "#", ".", ".", ".", ".", "#"],
          ["O", "O", ".", ".", "O", "#", "#", ".", ".", "O"],
          [".", "O", ".", "#", ".", ".", ".", "O", ".", "."],
          ["O", ".", ".", ".", ".", "O", ".", ".", "#", "."],
          [".", ".", "#", ".", ".", ".", "O", "#", ".", "#"],
          [".", ".", "O", ".", ".", "#", ".", "O", ".", "O"],
          [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
          ["#", "O", "O", ".", ".", "#", "#", "#", ".", "."],
          ["#", ".", ".", ".", ".", "#", ".", ".", ".", "."],
        ],
      )
    end
  end

  describe ".tilt_all_the_way" do
    it "moves all rocks that can move in ALL THE WAY in the provided direction" do
      rocks_map = RocksMap.new(
        <<~ROCKS_MAP,
          O....#....
          O.OO#....#
          .....##...
          OO.#O....O
          .O.....O#.
          O.#..O.#.#
          ..O..#O..O
          .......O..
          #....###..
          #OO..#....
      ROCKS_MAP
      )

      expect(rocks_map.tilt_all_the_way(:north).geography).to eq(
        [
          ["O", "O", "O", "O", ".", "#", ".", "O", ".", "."],
          ["O", "O", ".", ".", "#", ".", ".", ".", ".", "#"],
          ["O", "O", ".", ".", "O", "#", "#", ".", ".", "O"],
          ["O", ".", ".", "#", ".", "O", "O", ".", ".", "."],
          [".", ".", ".", ".", ".", ".", ".", ".", "#", "."],
          [".", ".", "#", ".", ".", ".", ".", "#", ".", "#"],
          [".", ".", "O", ".", ".", "#", ".", "O", ".", "O"],
          [".", ".", "O", ".", ".", ".", ".", ".", ".", "."],
          ["#", ".", ".", ".", ".", "#", "#", "#", ".", "."],
          ["#", ".", ".", ".", ".", "#", ".", ".", ".", "."],
        ],
      )
    end
  end
end
